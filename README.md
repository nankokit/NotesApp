# API для управления заметками

## Описание

NotesApp — это RESTful API, разработанное для управления заметками, тегами, изображениями с аутентификацией пользователей. Приложение реализовано с использованием чистой архитектуры и паттерна MediatR для обработки команд и запросов, что обеспечивает высокую модульность и тестируемость. API позволяет регистрировать пользователей, создавать, обновлять, удалять и искать заметки, управлять тегами, а также загружать и получать изображения, хранящиеся в MinIO. Аутентификация реализована с использованием JWT, а валидация данных осуществляется через FluentValidation. Кастомные исключения обеспечивают структурированную обработку ошибок.

## Основной функционал

- **Аутентификация**:
  - Регистрация пользователей (`/api/Auth/register`).
  - Вход в систему с выдачей JWT и refresh-токена (`/api/Auth/login`).
  - Обновление JWT через refresh-токен (`/api/Auth/refresh`).
  - Получение информации о текущем пользователе (`/api/Auth/me`).
  - Удаление учетной записи пользователя (`/api/Auth/me`).

- **Заметки**:
  - Создание новой заметки (`/api/Notes`).
  - Создание множества заметок (`/api/Notes/bulk`).
  - Поиск заметок с фильтрацией по тегам и сортировкой (`/api/Notes/search`).
  - Получение заметки по ID (`/api/Notes/{id}`).
  - Обновление заметки (`/api/Notes/{id}`).
  - Удаление заметки (`/api/Notes/{id}`).
  - Получение изображения, связанного с заметкой (`/api/Notes/image/{fileName}`).

- **Теги**:
  - Получение списка всех тегов (`/api/Tags`).
  - Создание нового тега (`/api/Tags`).
  - Получение тега по ID (`/api/Tags/{id}`) или имени (`/api/Tags/ByName/{name}`).
  - Обновление тега (`/api/Tags/{id}`).
  - Удаление тега (`/api/Tags/{id}`).

- **Изображения**:
  - Загрузка изображения в MinIO (`/api/Image/upload`).
  - Получение изображения по имени файла (`/api/Image/{fileName}`).
  - Получение URL для доступа к изображению (`/api/Image/url/{fileName}`).
  - Удаление изображения (`/api/Image/{fileName}`).

## Технологии

- **C# & .NET Core 8**
- **ASP.NET Core**
- **Entity Framework Core**
- **PostgreSQL 16** для хранения пользователей, заметок и тегов
- **MinIO** для хранения изображений
- **MediatR**
- **Onion Architecture**
- **FluentValidation** для валидации DTO и входных данных
- **xUnit**
- **Docker**
- **JWT**

## Требования

- Установленный Docker и Docker Compose.
- .NET SDK 8.0 (для локальной разработки, если не используется Docker).
- Доступ к интернету для загрузки образов Docker.

## Инструкция для запуска

1. **Клонируйте репозиторий**:
   ```bash
   git clone https://github.com/nankokit/NotesApp.git
   cd NotesApp
   ```

2. **Запустите приложение с помощью Docker Compose**:
   ```bash
   docker-compose up --build
   ```
   Это развернет три сервиса:
   - **notesapp**: API на порту `8080`.
   - **postgres**: PostgreSQL на порту `5433`.
   - **minio**: MinIO на портах `9000` (API) и `9001` (консоль).

3. **Проверка работоспособности**:
   - После запуска откройте браузер и перейдите по адресу `http://localhost:8080/swagger` для доступа к Swagger UI, где можно протестировать все эндпоинты API.
   - Для доступа к консоли MinIO откройте `http://localhost:9001` (логин: `minioadmin`, пароль: `minioadmin`).

4. **Остановка приложения**:
   ```bash
   docker-compose down
   ```
   Для очистки томов (данные PostgreSQL и MinIO будут удалены):
   ```bash
   docker-compose down -v
   ```
